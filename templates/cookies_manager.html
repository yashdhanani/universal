<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cookies Manager - Universal Media Downloader</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🍪</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .session-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .session-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
  </style>
</head>

<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen font-sans">
  <div class="container mx-auto px-4 py-8 max-w-6xl">
    <!-- Header -->
    <header class="text-center mb-8">
      <div class="flex items-center justify-center gap-3 mb-4">
        <span class="text-4xl">🍪</span>
        <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-purple-500">
          Cookies Manager
        </h1>
      </div>
      <p class="text-gray-500 dark:text-gray-400">
        Manage authentication cookies for private posts on Instagram, Facebook, and other platforms
      </p>
      <div class="mt-4">
        <a href="/universal_tailwind" class="inline-flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg transition-colors">
          ← Back to Downloader
        </a>
      </div>
    </header>

    <!-- Upload Section -->
    <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 mb-8">
      <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
        <span>📤</span> Upload Cookies
      </h2>
      
      <div class="grid md:grid-cols-2 gap-6">
        <!-- Platform Selection -->
        <div>
          <label class="block text-sm font-medium mb-2">Platform</label>
          <select id="platform-select" class="w-full bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="instagram">Instagram</option>
            <option value="facebook">Facebook</option>
            <option value="twitter">Twitter/X</option>
            <option value="tiktok">TikTok</option>
            <option value="pinterest">Pinterest</option>
            <option value="snapchat">Snapchat</option>
            <option value="linkedin">LinkedIn</option>
            <option value="reddit">Reddit</option>
          </select>
        </div>

        <!-- Session Name -->
        <div>
          <label class="block text-sm font-medium mb-2">Session Name</label>
          <input type="text" id="session-name" placeholder="default" class="w-full bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
      </div>

      <!-- Cookies Content -->
      <div class="mt-4">
        <label class="block text-sm font-medium mb-2">Cookies Content (Netscape format)</label>
        <textarea id="cookies-content" rows="8" placeholder="# Netscape HTTP Cookie File
# This is a generated file! Do not edit.

.instagram.com	TRUE	/	FALSE	1234567890	sessionid	your_session_id_here
.instagram.com	TRUE	/	FALSE	1234567890	csrftoken	your_csrf_token_here" 
          class="w-full bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm"></textarea>
      </div>

      <!-- Upload Button -->
      <div class="mt-4 flex gap-3">
        <button id="upload-btn" class="flex items-center gap-2 px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-colors">
          <span>📤</span> Upload Cookies
        </button>
        <button id="validate-btn" class="flex items-center gap-2 px-6 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold transition-colors">
          <span>✅</span> Validate
        </button>
      </div>

      <!-- Status Message -->
      <div id="upload-status" class="mt-4 hidden"></div>
    </div>

    <!-- How to Get Cookies -->
    <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-2xl p-6 mb-8">
      <h3 class="text-lg font-semibold mb-3 flex items-center gap-2 text-yellow-800 dark:text-yellow-200">
        <span>💡</span> How to Get Cookies
      </h3>
      <div class="space-y-3 text-sm text-yellow-700 dark:text-yellow-300">
        <div class="flex items-start gap-2">
          <span class="font-semibold">1.</span>
          <span>Install a browser extension like "Get cookies.txt LOCALLY" or "cookies.txt"</span>
        </div>
        <div class="flex items-start gap-2">
          <span class="font-semibold">2.</span>
          <span>Log into the platform (Instagram, Facebook, etc.) in your browser</span>
        </div>
        <div class="flex items-start gap-2">
          <span class="font-semibold">3.</span>
          <span>Use the extension to export cookies in Netscape format</span>
        </div>
        <div class="flex items-start gap-2">
          <span class="font-semibold">4.</span>
          <span>Copy and paste the cookies content above, then upload</span>
        </div>
      </div>
    </div>

    <!-- Sessions List -->
    <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold flex items-center gap-2">
          <span>📋</span> Cookie Sessions
        </h2>
        <div class="flex gap-2">
          <button id="refresh-btn" class="flex items-center gap-2 px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg transition-colors">
            <span>🔄</span> Refresh
          </button>
          <button id="cleanup-btn" class="flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors">
            <span>🧹</span> Cleanup Old
          </button>
        </div>
      </div>

      <!-- Sessions Grid -->
      <div id="sessions-container" class="grid gap-4">
        <div class="text-center py-8 text-gray-500">
          <span class="text-4xl block mb-2">🔄</span>
          Loading sessions...
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = window.location.origin;

    // Platform icons
    const platformIcons = {
      instagram: '📷',
      facebook: '📘',
      twitter: '🐦',
      tiktok: '🎵',
      pinterest: '📌',
      snapchat: '👻',
      linkedin: '💼',
      reddit: '🤖',
      youtube: '📺'
    };

    // Upload cookies
    document.getElementById('upload-btn').addEventListener('click', async () => {
      const platform = document.getElementById('platform-select').value;
      const sessionName = document.getElementById('session-name').value || 'default';
      const cookiesContent = document.getElementById('cookies-content').value.trim();

      if (!cookiesContent) {
        showStatus('Please enter cookies content', 'error');
        return;
      }

      try {
        showStatus('Uploading cookies...', 'loading');
        
        const response = await fetch(`${API_BASE}/api/auth/cookies/upload?platform=${platform}&session_name=${sessionName}`, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain' },
          body: cookiesContent
        });

        const result = await response.json();
        
        if (result.success) {
          showStatus(`✅ ${result.message}`, 'success');
          document.getElementById('cookies-content').value = '';
          loadSessions();
        } else {
          showStatus(`❌ ${result.message}`, 'error');
        }
      } catch (error) {
        showStatus(`❌ Upload failed: ${error.message}`, 'error');
      }
    });

    // Validate cookies
    document.getElementById('validate-btn').addEventListener('click', async () => {
      const platform = document.getElementById('platform-select').value;
      const sessionName = document.getElementById('session-name').value || 'default';

      try {
        showStatus('Validating cookies...', 'loading');
        
        const response = await fetch(`${API_BASE}/api/auth/cookies/validate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ platform, session_name: sessionName })
        });

        const result = await response.json();
        
        if (result.valid) {
          showStatus(`✅ ${result.message}`, 'success');
        } else {
          showStatus(`❌ ${result.message}`, 'error');
        }
      } catch (error) {
        showStatus(`❌ Validation failed: ${error.message}`, 'error');
      }
    });

    // Load sessions
    async function loadSessions() {
      try {
        const response = await fetch(`${API_BASE}/api/auth/cookies/sessions`);
        const data = await response.json();
        
        renderSessions(data.sessions);
      } catch (error) {
        document.getElementById('sessions-container').innerHTML = `
          <div class="text-center py-8 text-red-500">
            <span class="text-4xl block mb-2">❌</span>
            Failed to load sessions: ${error.message}
          </div>
        `;
      }
    }

    // Render sessions
    function renderSessions(sessions) {
      const container = document.getElementById('sessions-container');
      
      if (!sessions || sessions.length === 0) {
        container.innerHTML = `
          <div class="text-center py-8 text-gray-500">
            <span class="text-4xl block mb-2">📭</span>
            No cookie sessions found. Upload some cookies to get started!
          </div>
        `;
        return;
      }

      // Group by platform
      const grouped = sessions.reduce((acc, session) => {
        if (!acc[session.platform]) acc[session.platform] = [];
        acc[session.platform].push(session);
        return acc;
      }, {});

      container.innerHTML = Object.entries(grouped).map(([platform, platformSessions]) => `
        <div class="border border-gray-200 dark:border-gray-600 rounded-xl p-4">
          <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">
            <span>${platformIcons[platform] || '🌐'}</span>
            ${platform.charAt(0).toUpperCase() + platform.slice(1)}
            <span class="text-sm font-normal text-gray-500">(${platformSessions.length} sessions)</span>
          </h3>
          <div class="grid gap-3">
            ${platformSessions.map(session => `
              <div class="session-card bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-600 rounded-lg p-4">
                <div class="flex items-center justify-between">
                  <div class="flex-1">
                    <div class="flex items-center gap-2 mb-1">
                      <span class="font-semibold">${session.session_name}</span>
                      <span class="text-xs px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full">
                        ${session.status}
                      </span>
                    </div>
                    <div class="text-sm text-gray-500 space-y-1">
                      <div>Created: ${new Date(session.created_at).toLocaleDateString()}</div>
                      <div>Last used: ${new Date(session.last_used).toLocaleDateString()}</div>
                      <div>Usage count: ${session.usage_count || 0}</div>
                      ${session.file_size ? `<div>Size: ${(session.file_size / 1024).toFixed(1)} KB</div>` : ''}
                    </div>
                  </div>
                  <div class="flex gap-2">
                    <button onclick="validateSession('${session.platform}', '${session.session_name}')" 
                            class="px-3 py-1 bg-green-500 hover:bg-green-600 text-white rounded text-sm transition-colors">
                      ✅ Test
                    </button>
                    <button onclick="exportSession('${session.platform}', '${session.session_id}')" 
                            class="px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm transition-colors">
                      📤 Export
                    </button>
                    <button onclick="deleteSession('${session.platform}', '${session.session_id}')" 
                            class="px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm transition-colors">
                      🗑️ Delete
                    </button>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `).join('');
    }

    // Session actions
    async function validateSession(platform, sessionName) {
      try {
        showStatus('Validating session...', 'loading');
        
        const response = await fetch(`${API_BASE}/api/auth/cookies/validate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ platform, session_name: sessionName })
        });

        const result = await response.json();
        showStatus(result.valid ? `✅ ${result.message}` : `❌ ${result.message}`, result.valid ? 'success' : 'error');
      } catch (error) {
        showStatus(`❌ Validation failed: ${error.message}`, 'error');
      }
    }

    async function exportSession(platform, sessionId) {
      try {
        const response = await fetch(`${API_BASE}/api/auth/cookies/export/${platform}/${sessionId}`);
        
        if (response.ok) {
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `${platform}_${sessionId}_cookies.zip`;
          a.click();
          window.URL.revokeObjectURL(url);
          showStatus('✅ Session exported successfully', 'success');
        } else {
          throw new Error('Export failed');
        }
      } catch (error) {
        showStatus(`❌ Export failed: ${error.message}`, 'error');
      }
    }

    async function deleteSession(platform, sessionId) {
      if (!confirm('Are you sure you want to delete this session?')) return;

      try {
        const response = await fetch(`${API_BASE}/api/auth/cookies/sessions/${platform}/${sessionId}`, {
          method: 'DELETE'
        });

        const result = await response.json();
        
        if (result.success) {
          showStatus('✅ Session deleted successfully', 'success');
          loadSessions();
        } else {
          showStatus(`❌ ${result.message}`, 'error');
        }
      } catch (error) {
        showStatus(`❌ Delete failed: ${error.message}`, 'error');
      }
    }

    // Cleanup old sessions
    document.getElementById('cleanup-btn').addEventListener('click', async () => {
      if (!confirm('Delete sessions older than 30 days?')) return;

      try {
        const response = await fetch(`${API_BASE}/api/auth/cookies/cleanup`, {
          method: 'POST'
        });

        const result = await response.json();
        showStatus(`✅ Cleaned ${result.count} old sessions`, 'success');
        loadSessions();
      } catch (error) {
        showStatus(`❌ Cleanup failed: ${error.message}`, 'error');
      }
    });

    // Refresh sessions
    document.getElementById('refresh-btn').addEventListener('click', loadSessions);

    // Show status message
    function showStatus(message, type) {
      const statusEl = document.getElementById('upload-status');
      statusEl.className = `mt-4 p-3 rounded-lg ${
        type === 'success' ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200' :
        type === 'error' ? 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200' :
        'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200'
      }`;
      statusEl.textContent = message;
      statusEl.classList.remove('hidden');

      if (type !== 'loading') {
        setTimeout(() => statusEl.classList.add('hidden'), 5000);
      }
    }

    // Load sessions on page load
    loadSessions();
  </script>
</body>
</html>