flowchart TB
  %% UI Buttons
  ui_best_mp4["âš¡ Best MP4"]
  ui_best_mp3["âš¡ Best MP3"]
  ui_best_merge["âš¡ Best Merge (MKV/MP4)"]
  ui_instant["ğŸ¬ Smart Instant (progressive)"]
  ui_video_only["ğŸ¥ Video-only (no audio)"]
  ui_audio_only["ğŸµ Audio-only (rows)"]
  ui_img_single["ğŸ–¼ï¸ Smart Image"]
  ui_img_zip["ğŸ–¼ï¸ ZIP of Images"]
  ui_analyze["ğŸ” Analyze"]
  ui_signed["ğŸ”‘ Signed Download"]
  ui_celery["ğŸ“¦ Universal Celery DL"]

  %% API Endpoints
  api_redirect["GET /api/redirect?url=...&format_id=best"]
  api_merge_mp3["POST /api/merge { mp3_bitrate }"]
  api_merge_best["POST /api/merge { video_format_id: 'best' }"]
  api_stream["GET /api/stream?url=...&format_id=...&filename=..."]
  api_merge_video["POST /api/merge { video_format_id }"]
  api_passthrough["GET /api/passthrough?url=...&filename=..."]
  api_zip["POST /api/{platform}/download_images_zip"]
  api_info["GET /api/v2/{platform}/info?url=..."]
  api_sign["GET /api/v2/sign?platform=...&url=...&format_id=...&filename=..."]
  api_dl["GET /dl?token=..."]
  api_v2_dl["POST /api/v2/{platform}/download { url, format_id }"]

  %% Results
  res_cdn["â†’ Direct CDN MP4 (progressive)"]
  res_mp3["â†’ Server-side MP3 transcode"]
  res_merge["â†’ Server merges video+audio"]
  res_stream["â†’ Direct MP4 stream with filename"]
  res_merge_mp4["â†’ Server merge + MP4"]
  res_mp3_rows["â†’ Server transcode â†’ MP3"]
  res_img["â†’ Direct image download"]
  res_zip["â†’ Streamed ZIP file"]
  res_meta["â†’ Metadata + formats"]
  res_signed["â†’ One-time smart link"]
  res_task["â†’ Task w/ progress â†’ /download/{file}"]

  %% Flows
  ui_best_mp4 --> api_redirect --> res_cdn
  ui_best_mp3 --> api_merge_mp3 --> res_mp3
  ui_best_merge --> api_merge_best --> res_merge
  ui_instant --> api_stream --> res_stream
  ui_video_only --> api_merge_video --> res_merge_mp4
  ui_audio_only --> api_merge_mp3 --> res_mp3_rows
  ui_img_single --> api_passthrough --> res_img
  ui_img_zip --> api_zip --> res_zip
  ui_analyze --> api_info --> res_meta
  ui_signed --> api_sign --> api_dl --> res_signed
  ui_celery --> api_v2_dl --> res_task